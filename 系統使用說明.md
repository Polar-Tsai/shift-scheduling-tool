# 排班工具系統使用說明

## 🎯 系統概述

本排班工具專為餐飲業設計，實現「一處完成蒐集→編排→審核→發布→匯出」的完整流程，解決傳統 Excel/紙本/LINE 分散管理的痛點。

## 🚀 快速啟動

### 方法一：使用啟動腳本（推薦）
```bash
# Windows
start.bat

# Linux/Mac
./start.sh
```

### 方法二：手動啟動
```bash
# 1. 安裝依賴套件
npm install

# 2. 建置前端
npm run build

# 3. 啟動系統
npm start
```

### 方法三：開發模式
```bash
# 啟動後端 API
npm run dev

# 另開終端機啟動前端開發伺服器
npm run dev:client
```

## 🔐 登入資訊

### 預設管理員
- **帳號**: admin
- **密碼**: admin123
- **權限**: 系統管理員（所有功能）

### 演示帳號
- **排班編輯者**: editor1 / editor123
- **外場主管**: approver1 / approver123  
- **區經理**: approver2 / approver123
- **一般員工**: viewer1 / viewer123

## 📱 系統功能

### 1. 看板 (Dashboard)
- **統計數據**: 總員工數、待審核排班、本週工時、加班警示
- **本週班表**: 當前週期排班概覽
- **警示事項**: 待審核項目、SLA 逾時提醒
- **快速操作**: 一鍵進入各功能模組

### 2. 排班管理 (Schedule)
- **建立排班**: 選擇店鋪和週期建立新排班表
- **自動排班**: 智慧演算法自動分配班次
- **手動調整**: 拖拉式班表編輯
- **違規提示**: 即時檢核工時、連續上班、崗位需求
- **提交審核**: 一鍵提交給外場主管審核

### 3. 員工管理 (Employees)
- **員工資料**: 姓名、類型（正職/PT）、主要職位、技能
- **聯絡資訊**: 員工編號、Email、電話
- **新增員工**: 完整的員工資料表單
- **編輯功能**: 修改員工基本資料

### 4. 審核流程 (Approval)
- **多層級審核**: 外場主管 → 區經理
- **SLA 管理**: 24小時審核期限
- **自動核可**: 逾時自動通過並通知
- **審核意見**: 支援退回原因說明
- **狀態追蹤**: 即時顯示審核進度

### 5. 匯出功能 (Export)
- **PDF 紙本版型**: 適合列印的班表格式
- **CSV 打卡匯入**: 符合打卡系統格式
- **自訂檔名**: 包含店鋪、週期、版本資訊
- **一鍵下載**: 直接下載到本地

## ⚙️ 排班規則

### 工時限制
- **正職員工**: 每日最大 12 小時，連續上班最多 5 天
- **PT 員工**: 每日最大 10 小時，連續上班最多 6 天
- **標準休息**: 每日 120 分鐘，不足部分計入加班

### 餐期設定
- **早餐期**: 10:00-14:00
- **晚餐期**: 18:00-22:00
- **跨餐期**: 自動切分為兩筆指派

### 崗位需求
- **最低人數**: 每餐期每崗位至少 1 人
- **崗位類型**: 收銀、服務、廚房、支援
- **技能匹配**: 自動檢核員工技能與崗位需求

### 公平性原則
- **週末班輪替**: 避免特定員工過度排班
- **晚餐期分配**: 公平分配晚餐期班次
- **工時平衡**: 確保員工工時分配合理

## 🔄 工作流程

### 1. 需求蒐集
- 員工提交休假申請
- 填寫可上時段偏好
- 選擇偏好班別和崗位

### 2. 自動排班
- 系統根據營收預測計算人力需求
- 自動分配正職最低量
- PT 員工補足缺口
- 產生排班草案

### 3. 手動調整
- 排班負責人檢視草案
- 根據實際情況微調
- 解決違規和衝突
- 確認最終排班

### 4. 審核流程
- 提交給外場主管審核（24h SLA）
- 外場主管核可後提交區經理（24h SLA）
- 區經理核可後自動發布
- 逾時自動核可並通知

### 5. 發布與匯出
- 自動通知所有相關員工
- 提供 PDF 紙本版型
- 匯出 CSV 供打卡系統匯入
- 支援 LINE 群組分享

## 📊 資料格式

### CSV 匯出格式
```csv
emp_no,date,start_time,end_time,break_minutes,role,store_id,is_peak,regular_hours,overtime_hours,consec_days,notes
EMP001,2025-01-13,10:00,14:00,120,cashier,1,AM,4.00,0.00,1,
EMP002,2025-01-13,18:00,22:00,120,server,1,PM,4.00,0.00,1,
```

### 檔名規則
- **CSV**: `{storeId}_{weekStart}_v1.csv`
- **PDF**: `排班表_{storeId}_第{weekNumber}週_{weekStart}.html`

## 🛠️ 系統管理

### 資料庫
- **類型**: SQLite
- **位置**: `scheduling.db`
- **備份**: 定期備份此檔案即可

### 配置設定
- **JWT 密鑰**: 生產環境請修改 `JWT_SECRET`
- **通知設定**: 配置 LINE/Email 服務
- **規則參數**: 可透過管理介面調整

### 監控與維護
- **日誌記錄**: 所有操作都有完整記錄
- **效能監控**: 支援系統效能追蹤
- **錯誤處理**: 完善的錯誤處理機制

## 🔧 故障排除

### 常見問題

**Q: 無法登入系統**
A: 檢查帳號密碼是否正確，確認資料庫是否正常運行

**Q: 排班表無法提交審核**
A: 檢查是否有違規項目，確認所有必填欄位已填寫

**Q: 匯出功能無法使用**
A: 確認排班表狀態為「已發布」，檢查瀏覽器下載設定

**Q: 通知功能不工作**
A: 檢查 LINE/Email 配置是否正確，確認網路連線

### 系統檢查
```bash
# 執行系統測試
node test-system.js

# 建立演示資料
node demo.js

# 檢查系統狀態
npm run status
```

## 📞 技術支援

### 系統需求
- **Node.js**: 16.0 或以上版本
- **瀏覽器**: Chrome 80+, Firefox 75+, Safari 13+
- **記憶體**: 建議 4GB 以上
- **儲存空間**: 至少 1GB 可用空間

### 聯絡資訊
- **開發單位**: 鉅鋼機械股份有限公司 IT 部門
- **技術支援**: [聯絡方式]
- **問題回報**: [問題回報管道]

## 📈 版本更新

### v1.0.0 (2025-01-13)
- ✅ 基本排班功能
- ✅ 審核流程
- ✅ PDF/CSV 匯出
- ✅ 規則引擎
- ✅ 通知系統
- ✅ 響應式設計

### 未來規劃
- 🔄 多店鋪管理
- 🔄 進階報表功能
- 🔄 行動 APP
- 🔄 API 整合
- 🔄 雲端部署

---

**注意**: 本系統為內部使用工具，請妥善保管登入資訊，避免外洩敏感資料。
